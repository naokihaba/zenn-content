---
title: "Vue 3.5 ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã«ã¤ã„ã¦"
emoji: "ğŸ¦"
type: "tech"
topics: ["Vue", "JavaScript", "ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰"]
published: false
---

# ã¯ã˜ã‚ã«

2024å¹´9æœˆ1æ—¥ã« Vue 3.5 ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã—ãŸã€‚

ã“ã®è¨˜äº‹ã§ã¯ã€Vue 3.5 ã®ä¸»ãªæ©Ÿèƒ½æ”¹å–„ãƒ»è¿½åŠ ã¨ãã®èƒŒæ™¯ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚

https://blog.vuejs.org/posts/vue-3-5

## ä¸»ãªæ©Ÿèƒ½æ”¹å–„ãƒ»è¿½åŠ 

1. **Reactive Props Destructure ã®å®‰å®šåŒ–**
2. **SSRã®æ”¹å–„**
   - `Lazy Hydration`
   - `useId()`
   - `data-allow-mismatch`
3. **Custom Elements Improvements ã®æ”¹è‰¯**
4. **ãã®ä»–ã®æ©Ÿèƒ½è¿½åŠ **
   - `useTemplateRef()`
   - `Deferred Teleport`
   - `onWatcherCleanup()`
5. **Reactivity System ã®æ”¹å–„**ã«ã‚ˆã‚‹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š

## Reactive Props Destructure ã®å®‰å®šåŒ–

`<script setup>` å†…ã§ `defineProps` ã‹ã‚‰åˆ†å‰²ä»£å…¥ã•ã‚ŒãŸå¤‰æ•°ãŒè‡ªå‹•çš„ã«ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ãªã‚‹æ©Ÿèƒ½ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚³ãƒ¼ãƒ‰ãŒã‚ˆã‚Šç°¡æ½”ã«ãªã‚Šã€å¯èª­æ€§ãŒå‘ä¸Šã—ã¾ã™ã€‚

ã‚ˆã‚Šè©³ç´°ãªå†…éƒ¨å®Ÿè£…ã‚’çŸ¥ã‚ŠãŸã„æ–¹ã¯ä»¥ä¸‹ã®è¨˜äº‹ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

https://zenn.dev/comm_vue_nuxt/articles/reactive-props-destructure

### RFC

https://github.com/vuejs/rfcs/discussions/502

### ä½¿ç”¨ä¾‹

#### ä»¥å‰ã®æ›¸ãæ–¹ï¼š

```vue
<script setup lang="ts">
import { computed } from 'vue'

const props = withDefaults(defineProps<{
  count?: number
}>(), {
  count: 0
})

const double = computed(() => props.count * 2)
</script>

<template>
  <div>Count: {{ props.count }}</div>
  <div>Double: {{ double }}</div>
</template>
```

#### Vue 3.5 ä»¥é™ï¼š

```vue
<script setup lang="ts">
import { computed } from 'vue'

const { count = 0 } = defineProps<{
  count?: number
}>()

const double = computed(() => count * 2)
</script>

<template>
  <div>Count: {{ count }}</div>
  <div>Double: {{ double }}</div>
</template>
```

ã“ã®æ–°ã—ã„æ›¸ãæ–¹ã§ã¯ã€`withDefaults` ã‚’ä½¿ç”¨ã›ãšã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®šã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã¾ãŸã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒç›´æ¥çš„ã«ãªã‚Šã€ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§ãŒå‘ä¸Šã—ã¦ã„ã¾ã™ã€‚

### å†…éƒ¨çš„ãªå‹•ä½œã®å¤‰åŒ–

Vue 3.5ã®æ–°æ©Ÿèƒ½ã«ã‚ˆã‚Šã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«å¾Œã®ã‚³ãƒ¼ãƒ‰ã«ã‚‚å¤‰æ›´ãŒåŠ ãˆã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ä»¥ä¸‹ã«ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«å‰å¾Œã®ã‚³ãƒ¼ãƒ‰ã®é•ã„ã‚’ç¤ºã—ã¾ã™ã€‚

#### Reactive Props Destructure ä»¥å‰

å…¥åŠ›ï¼š

```vue
<script setup lang="ts">
import { computed } from 'vue'

const props = defineProps<{
  count?: number
}>()

const double = computed(() => props.count * 2)
</script>

<template>
  <div>Count: {{ count }}</div>
  <div>Double: {{ double }}</div>
</template>
```

å‡ºåŠ›ï¼ˆä¸€éƒ¨æŠœç²‹ï¼‰ï¼š

```js
const __sfc__ = /*#__PURE__*/_defineComponent({
  // ...
  setup(__props, { expose: __expose }) {
    __expose();

    const props = __props

    const double = computed(() => props.count * 2)

    const __returned__ = { props, double }
    // ...
    return __returned__
  }
});
```

#### Reactive Props Destructure ä»¥é™

å…¥åŠ›ï¼š

```vue
<script setup lang="ts">
import { computed } from 'vue'

const { count = 0 } = defineProps<{
  count?: number
}>()

const double = computed(() => count * 2)
</script>

<template>
  <div>Count: {{ count }}</div>
  <div>Double: {{ double }}</div>
</template>
```

å‡ºåŠ›ï¼ˆä¸€éƒ¨æŠœç²‹ï¼‰ï¼š

```js
const __sfc__ = /*#__PURE__*/_defineComponent({
  // ...
  props: {
    count: { type: Number, required: false, default: 0 }
  },
  setup(__props, { expose: __expose }) {
    __expose();

    const double = computed(() => __props.count * 2)

    const __returned__ = { double }
    // ...
    return __returned__
  }
});
```

ã“ã®å¤‰æ›´ã«ã‚ˆã‚Šã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã® `props` ã‚ªãƒ—ã‚·ãƒ§ãƒ³å†…ã§ç›´æ¥å®šç¾©ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã€`setup` é–¢æ•°å†…ã§ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å–ã‚Šæ‰±ã„ãŒç°¡ç•¥åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚

ãŸã ã—ã€RFCã§è¨€åŠã•ã‚Œã¦ã„ã‚‹é€šã‚Šã€`props` ã¨é€šå¸¸ã®å¤‰æ•°ã‚’è¦–è¦šçš„ã«åŒºåˆ¥ã™ã‚‹ã®ãŒé›£ã—ããªã£ã¦ã„ã‚‹ãŸã‚ã€`@vue/language-tools 2.1` ä»¥é™ã§ã¯ã€ã‚ªãƒ—ãƒˆã‚¤ãƒ³è¨­å®šã§ã‚¤ãƒ³ãƒ¬ã‚¤ãƒ’ãƒ³ãƒˆï¼ˆinlay hintsï¼‰ã‚’æœ‰åŠ¹ã«ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

```vue
<script setup lang="ts">
import { defineProps } from 'vue'

const { count = 0, msg = 'hello' } = defineProps<{
  count?: number
  message?: string
}>()

// props.count ã¨ props.msg ã®ä¸¡æ–¹ãŒã‚¤ãƒ³ãƒ¬ã‚¤ãƒ’ãƒ³ãƒˆã§ãƒã‚¤ãƒ©ã‚¤ãƒˆã•ã‚Œã‚‹
console.log(count, msg)
</script>
```

## SSRã®æ”¹å–„

### Lazy Hydration

https://github.com/vuejs/core/pull/11530

https://github.com/vuejs/core/pull/11458 

`hydrate` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã€ãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’åˆ¶å¾¡ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

1. Hydrate on Idle

`requestIdleCallback` ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¢ã‚¤ãƒ‰ãƒ«æ™‚é–“ã«ãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã„ã¾ã™ã€‚

```vue
<template>
  <AsyncComp />
</template>

<script setup>
import { defineAsyncComponent, hydrateOnIdle } from 'vue'

const AsyncComp = defineAsyncComponent({
  loader: () => import('./HeavyComponent.vue'),
  hydrate: hydrateOnIdle(5000) // æœ€å¤§5ç§’å¾…æ©Ÿ
})
</script>
```

2. Hydrate on Visible

`IntersectionObserver` ã‚’ä½¿ç”¨ã—ã¦ã€è¦ç´ ãŒè¡¨ç¤ºã•ã‚ŒãŸã¨ãã«ãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã„ã¾ã™ã€‚

```vue
<template>
  <div class="long-page">
    <div v-for="i in 20" :key="i" class="spacer">Scroll down...</div>
    <AsyncComp />
  </div>
</template>

<script setup>
import { defineAsyncComponent, hydrateOnVisible } from 'vue'

const AsyncComp = defineAsyncComponent({
  loader: () => import('./FooterComponent.vue'),
  hydrate: hydrateOnVisible({ rootMargin: '200px' })
})
</script>

<style scoped>
.long-page {
  height: 2000px;
}
.spacer {
  height: 100px;
}
</style>
```

3. Hydrate on Media Query

æŒ‡å®šã•ã‚ŒãŸãƒ¡ãƒ‡ã‚£ã‚¢ã‚¯ã‚¨ãƒªã«ä¸€è‡´ã—ãŸã¨ãã«ãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã„ã¾ã™ã€‚


```vue
<template>
  <div>
    <AsyncDesktopComp v-if="!isMobile" />
    <AsyncMobileComp v-else />
  </div>
</template>

<script setup>
import { defineAsyncComponent, hydrateOnMediaQuery, ref, onMounted } from 'vue'

const isMobile = ref(false)

const AsyncDesktopComp = defineAsyncComponent({
  loader: () => import('./DesktopComponent.vue'),
  hydrate: hydrateOnMediaQuery('(min-width:501px)')
})

const AsyncMobileComp = defineAsyncComponent({
  loader: () => import('./MobileComponent.vue'),
  hydrate: hydrateOnMediaQuery('(max-width:500px)')
})

onMounted(() => {
  isMobile.value = window.innerWidth <= 500
  window.addEventListener('resize', () => {
    isMobile.value = window.innerWidth <= 500
  })
})
</script>
```

4. Hydrate on Interaction


æŒ‡å®šã•ã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆãŒã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¦ç´ ã§ç™ºç”Ÿã—ãŸã¨ãã«ãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã„ã¾ã™ã€‚

```vue
<template>
  <AsyncButton>Click me</AsyncButton>
</template>

<script setup>
import { defineAsyncComponent, hydrateOnInteraction } from 'vue'

const AsyncButton = defineAsyncComponent({
  loader: () => import('./InteractiveButton.vue'),
  hydrate: hydrateOnInteraction(['mouseover', 'focus'])
})
</script>
```

ã‚«ã‚¹ã‚¿ãƒ ã®ãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æˆ¦ç•¥ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™

```vue
<script setup>
import { defineAsyncComponent, type HydrationStrategy } from 'vue'

const myStrategy: HydrationStrategy = (hydrate, forEachElement) => {
  // forEachElement is a helper to iterate through all the root elememts
  // in the component's non-hydrated DOM, since the root can be a fragment
  // instead of a single element
  forEachElement(el => {
    // ...
  })
  // call `hydrate` when ready
  hydrate()
  return () => {
    // return a teardown function if needed
  }
}

const AsyncComp = defineAsyncComponent({
  loader: () => import('./Comp.vue'),
  hydrate: myStrategy
})
</script>
```

### useId()


### data-allow-mismatch


## Custom Elements Improvements ã®æ”¹è‰¯


## ãã®ä»–ã®æ©Ÿèƒ½è¿½åŠ 

### useTemplateRef()


### Deferred Teleport


### onWatcherCleanup()


## Reactivity System ã®æ”¹å–„ã«ã‚ˆã‚‹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š

Vue 3.5ã§ã¯ã€ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚·ã‚¹ãƒ†ãƒ ã®å†…éƒ¨å®Ÿè£…ãŒæœ€é©åŒ–ã•ã‚Œã€å…¨ä½“çš„ãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒå‘ä¸Šã—ã¾ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ç‰¹ã«å¤§è¦æ¨¡ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚ˆã‚Šé«˜é€Ÿãªå‹•ä½œãŒæœŸå¾…ã§ãã¾ã™ã€‚

## ã¾ã¨ã‚

Vue 3.5ã¯ã€é–‹ç™ºè€…ã®ç”Ÿç”£æ€§ã‚’å‘ä¸Šã•ã›ã‚‹å¤šãã®æ©Ÿèƒ½æ”¹å–„ã¨è¿½åŠ ã‚’å«ã‚“ã§ã„ã¾ã™ã€‚Reactive Props Destructureã®å®‰å®šåŒ–ã€SSRã®æ”¹å–„ã€Custom Elementsã®æ”¹è‰¯ãªã©ã«ã‚ˆã‚Šã€ã‚ˆã‚ŠåŠ¹ç‡çš„ã‹ã¤æŸ”è»Ÿãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºãŒå¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚ã¾ãŸã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å‘ä¸Šã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚‚ã•ã‚‰ã«å‘ä¸Šã™ã‚‹ã“ã¨ãŒæœŸå¾…ã§ãã¾ã™ã€‚

ã“ã‚Œã‚‰ã®æ–°æ©Ÿèƒ½ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€Vue.jsã‚’ä½¿ç”¨ã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºãŒã•ã‚‰ã«å¿«é©ã«ãªã‚‹ã§ã—ã‚‡ã†ã€‚
