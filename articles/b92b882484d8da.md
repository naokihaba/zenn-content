---
title: "ã€Nginxã€‘xxx/xxx.php ã‚’ä»»æ„ã®URLã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã›ãŸã¨ãã®å‚™å¿˜éŒ²"
emoji: "ğŸ““"
type: "tech"
topics:
  - "laravel"
  - "nginx"
published: true
published_at: "2022-01-15 07:26"
---

# ã¯ã˜ã‚ã«

ç‰¹å®šã®ãƒ‘ã‚¹ã‚’æŒ‡å®šã—ãŸå ´åˆã«`nginx`ã§ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã›ã‚‹å‡¦ç†ã‚’è¿½åŠ ã—ãŸéš›ã®å‚™å¿˜éŒ²ã§ã™
ã¾ãŸã€`nginx.conf`ã®èª­ã¿æ–¹ãŒæ›–æ˜§ã ã£ãŸã®ã§ä»¥ä¸‹ã®è¨˜äº‹ã‚’å‚è€ƒã«æ•´ç†ã—ã¦ã¿ã¾ã—ãŸ

https://qiita.com/morrr/items/7c97f0d2e46f7a8ec967

https://heartbeats.jp/hbblog/2012/04/nginx04.html

https://nulab.com/ja/blog/typetalk/measure-clickjacking/

https://www.templarbit.com/blog/jp/2018/07/24/top-http-security-headers-and-how-to-deploy-them/

https://qiita.com/k_hoso/items/33ccb5e02e73a244ed31

# ã‚„ã‚Šæ–¹

ä»¥ä¸‹ã‚’è¿½åŠ ã™ã‚‹

```conf:/nginx/default.conf
    location /hoge/index.php {
        return 301 http://example.com/
    }
```


# è¨­å®šè§£èª¬

`server {}`:ãƒãƒ¼ãƒãƒ£ãƒ«(ä»®æƒ³ï¼‰ã‚µãƒ¼ãƒã®è¨­å®šã‚’è¨˜è¿°
`listen 80;`ï¼šIPç•ªå·ã¨ãƒãƒ¼ãƒˆç•ªå·ã‚’æŒ‡å®šã™ã‚‹
`server_name`:ã‚µãƒ¼ãƒåã‚’æŒ‡å®šã™ã‚‹
`root`:ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ«ãƒ¼ãƒˆã‚’æŒ‡å®šã™ã‚‹
`add_header`:ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ ã™ã‚‹ã€‚
`X-Frame-Options "SAMEORIGIN";`:åŒã˜ãƒ‰ãƒ¡ã‚¤ãƒ³å†…ã®ã¿ãƒšãƒ¼ã‚¸ã®è¡¨ç¤ºã‚’è¨±å¯ã™ã‚‹
`X-XSS-Protection "1; mode=block";`:XSSæ”»æ’ƒã‚’æ¤œçŸ¥ã—ã¦ã—ãŸéš›ã«èª­ã¿è¾¼ã‚€ã“ã¨ã‚’é˜²æ­¢ã™ã‚‹
`X-Content-Type-Options "nosniff";`:ãƒªã‚½ãƒ¼ã‚¹ã®Content-Typeã‚’ç„¡è¦–ã™ã‚‹ã“ã¨ãŒãªããªã‚Šã€HTMLã§ã¯ãªã„ã‚‚ã®ã‚’HTMLæ‰±ã„ã—ã¦ã—ã¾ã†ã“ã¨ã«ã‚ˆã‚‹XSSã‚’é˜²ã
`index`:indexãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹
`charset`:ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ã®Content-typeã‚’æŒ‡å®šã™ã‚‹
`location`:ãƒ‘ã‚¹ã”ã¨å€‹åˆ¥ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ«ãƒ¼ãƒˆã‚’è¨­å®šå¯èƒ½
`location /`:ãƒ«ãƒ¼ãƒˆãƒ‘ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚ŒãŸå ´åˆã«ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå†…ã®å‡¦ç†ã‚’è¡Œã†
`try_files`: ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ 
`$uri $uri/`:`/hoge`ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«åãŒãªã„å ´åˆ
`$uri/`:`./hoge`ã¨ã„ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æ¢ã™
`/index.php?$query_string`:`/index.php`ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ãªã‘ã‚Œã°å†…éƒ¨ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹
`location = /favicon.ico { access_log off; log_not_found off; }`:`favicon`ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯ãƒ­ã‚°ã¸ã®è¨˜éŒ²ã‚ªãƒ•
`error_page 404 /index.php;`:404ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸã¨ãã«å†…éƒ¨ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ


```conf:/nginx/default.conf
server {
    listen 80;
   
    server_name example.com;
    root /work/public;

    add_header X-Frame-Options "SAMEORIGIN";
    add_header X-XSS-Protection "1; mode=block";
    add_header X-Content-Type-Options "nosniff";

    index index.php;

    charset utf-8;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location /hoge/index.php {
        return 301 http://example.com/
    }

    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt  { access_log off; log_not_found off; }

    error_page 404 /index.php;

    location ~ \.php$ {
        fastcgi_pass app:9000;
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        include fastcgi_params;
    }

    location ~ /\.(?!well-known).* {
        deny all;
    }
}
```

# ã•ã„ã”ã«
èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚
ã„ã„ã­ã—ã¦ã„ãŸã ã‘ã‚‹ã¨è¨˜äº‹åŸ·ç­†ã®åŠ±ã¿ã«ãªã‚Šã¾ã™ã®ã§ã€å‚è€ƒã«ãªã£ãŸã¨æ€ã£ãŸæ–¹ã¯æ˜¯éã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ï¼
