---
title: "ã€Laravelã€‘PrimaryKeyã‚’å¤–ã—ã¦ã‚«ãƒ©ãƒ ã‚’nullableã«ã™ã‚‹ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®æ›¸ãæ–¹"
emoji: "ðŸ—‚ï¸"
type: "tech"
topics:
  - "laravel"
  - "migration"
  - "ddl"
published: true
published_at: "2022-03-22 03:55"
---

# æ¦‚è¦

`PrimaryKey`ã«æŒ‡å®šã—ã¦ã„ãŸã‚«ãƒ©ãƒ ãŒ`NULL`ã‚’è¨±å®¹ã™ã‚‹ãŸã‚`DDL`ã‚’æ›´æ–°ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸã®ã§è§£æ±ºæ–¹æ³•ã‚’ã¾ã¨ã‚ã‚‹

```bash
 Syntax error or access violation: 1171 All parts of a PRIMARY KEY must be NOT NULL;
```

```php:ChangeProfileIdToTabletStaffMaps.php
class ChangeProfileIdToTabletStaffMaps extends Migration
{
    /**
     * Run the migrations.
     *
     * @return void
     */
    public function up()
    {
        Schema::table('tablet_staff_maps', function (Blueprint $table) {
            $table->dropPrimary('tablet_staff_maps_tablet_uuid_staff_id_profile_id_primary');
            $table->dropUnique('tablet_staff_maps_tablet_uuid_staff_id_profile_id_unique');
            $table->primary(['tablet_uuid', 'staff_id']);
            $table->unique(['tablet_uuid', 'staff_id']);
            $table->unsignedBigInteger('profile_id')->comment('ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ID')->nullable()->change();
        });
    }

    /**
     * Reverse the migrations.
     *
     * @return void
     */
    public function down()
    {
        Schema::table('tablet_staff_maps', function (Blueprint $table) {
            $table->dropPrimary('tablet_staff_maps_tablet_uuid_staff_id_primary');
            $table->dropUnique('tablet_staff_maps_tablet_uuid_staff_id_unique');
            $table->primary(['tablet_uuid', 'staff_id', 'profile_id']);
            $table->unique(['tablet_uuid', 'staff_id', 'profile_id']);
            $table->unsignedBigInteger('profile_id')->comment('ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ID')->change();
        });
    }
}
```

# ç’°å¢ƒ
- PHP 7.4.25
- Laravel Framework 6.20.44

# è§£æ±ºæ–¹æ³•

ã“ã¡ã‚‰ã®è¨˜äº‹ã‚’å‚è€ƒã«ã—ã¾ã—ãŸã€‚
è¨˜äº‹ã®é¡Œåé€šã‚Šãªã®ã§ã™ãŒå‡¦ç†ã‚’åˆ†å‰²ã—ã¦è¨˜è¿°ã™ã‚‹ã“ã¨ãŒå¿…è¦ã«ãªã‚Šã¾ã™

https://qiita.com/kazuhei/items/484ffe1fb8d9cbb056c1

```php:ChangeProfileIdToTabletStaffMaps.php
class ChangeProfileIdToTabletStaffMaps extends Migration
{
    /**
     * Run the migrations.
     *
     * @return void
     */
    public function up()
    {
        Schema::table('tablet_staff_maps', function (Blueprint $table) {
            $table->dropPrimary('tablet_staff_maps_tablet_uuid_staff_id_profile_id_primary');
        });

        Schema::table('tablet_staff_maps', function (Blueprint $table) {
            $table->dropUnique('tablet_staff_maps_tablet_uuid_staff_id_profile_id_unique');
        });

        Schema::table('tablet_staff_maps', function (Blueprint $table) {
            $table->primary(['tablet_uuid', 'staff_id']);
            $table->unique(['tablet_uuid', 'staff_id']);
            $table->unsignedBigInteger('profile_id')->comment('ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ID')->nullable()->change();
        });


    }

    /**
     * Reverse the migrations.
     *
     * @return void
     */
    public function down()
    {
        Schema::table('tablet_staff_maps', function (Blueprint $table) {
            $table->dropPrimary('tablet_staff_maps_tablet_uuid_staff_id_primary');
        });

        Schema::table('tablet_staff_maps', function (Blueprint $table) {
            $table->dropUnique('tablet_staff_maps_tablet_uuid_staff_id_unique');
        });

        Schema::table('tablet_staff_maps', function (Blueprint $table) {
            $table->primary(['tablet_uuid', 'staff_id', 'profile_id']);
            $table->unique(['tablet_uuid', 'staff_id', 'profile_id']);
            $table->unsignedBigInteger('profile_id')->comment('ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ID')->change();
        });
    }
}
```