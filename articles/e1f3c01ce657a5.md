---
title: "TypeORMã®ãƒˆãƒ©ãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒ æ©Ÿèƒ½ã®ã‚¹ã‚¹ãƒ¡"
emoji: "ğŸˆ"
type: "tech"
topics:
  - "typescript"
  - "typeorm"
  - "transformer"
published: true
published_at: "2021-11-28 16:26"
---

# æ¦‚è¦
TypeORMã®`transformeræ©Ÿèƒ½`ã‚’åˆ©ç”¨ã—ãŸéš›ã®å‚™å¿˜éŒ²ã§ã™
ã“ã‚Œã‹ã‚‰å°å…¥ã•ã‚Œã‚‹æ–¹ã‚„åˆã‚ã¦ä½¿ã†æ–¹ã®å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™

# ã‚„ã‚Šæ–¹

## å›ºå®šãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†ãƒ»æ“ä½œã™ã‚‹ãƒã‚¹ã‚¿ãƒ¼ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—ã¾ã™

:::message
ä»Šå›ã¯éƒ½é“åºœçœŒIDãƒ»éƒ½é“åºœçœŒåã®ã¿ç®¡ç†ã™ã‚‹ãŸã‚interfaceã‚’å®šç¾©ã—ã¾ã™
constractorã§å®šç¾©ã—ãŸIMasterå‹ã‚’å—ã‘å–ã‚Šã¾ã™
:::

```ts:master.master.ts
export class Master {
  private readonly masters: IMaster[]
  
  constructor(masters: IMaster[]) {
    this.masters = masters
  }

  findNameById(id: number) {
    return this.masters.find((v) => v.id === Number(id))
  }

  findIdByName(name: string) {
    return this.masters.find((v) => v.name === name)
  }
}

export interface IMaster {
  id: number
  name: string
}

```
	

## éƒ½é“åºœçœŒãƒ‡ãƒ¼ã‚¿ã‚’IMasteråŒ–ã—ã¾ã™

:::message
å…ˆç¨‹å®šç¾©ã—ãŸImasterå‹ã®é€šã‚Šéƒ½é“åºœçœŒIDãƒ»éƒ½é“åºœçœŒåã‚’å®šç¾©ã—ã¾ã™
å›ºå®šãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†ã™ã‚‹masterã‚¯ãƒ©ã‚¹ã‚’extendsï¼ˆç¶™æ‰¿ï¼‰ã—ã¦è¦ªã‚¯ãƒ©ã‚¹ã®constractorã‚’å‘¼ã³å‡ºã—ã¾ã™ï¼ˆsuper)
:::

```ts:Prefecture.ts
import { IMaster, Master } from './master.master'

const PREFECTURE: IMaster[] = [
  {
    id: 1,
    name: 'åŒ—æµ·é“',
  },
  {
    id: 2,
    name: 'é’æ£®çœŒ',
  },
  // çœç•¥ã—ã¾ã™
  {
    id: 47,
    name: 'æ²–ç¸„çœŒ',
  },
]

class PrefectureMaster extends Master {
  constructor() {
    super(PREFECTURE)
  }
}

export const Prefecture = new PrefectureMaster()
```

## transformerã‚’åˆ©ç”¨ã—ã¦Entityã‚’å®šç¾©ã—ã¾ã™

:::message
from = èª­ã¿è¾¼ã¿æ™‚ã«ã¯Imasterå‹ã‹ã‚‰éƒ½é“åºœçœŒIDã ã‘
to = æ›¸ãè¾¼ã¿æ™‚ã«ã¯ã¾ãšéƒ½é“åºœçœŒIDã‚’å—ã‘å–ã‚Šè©²å½“ã™ã‚‹éƒ½é“åºœçœŒã®Imasterå‹ã‚’DBã«ç™»éŒ²ã—ã¾ã™
:::

```ts
  @Column('tinyint', {
    unsigned: true,
    comment: 'éƒ½é“åºœçœŒID',
    transformer: {
      from(id: number): IMaster {
        return Prefecture.findNameById(id)
      },
      to(value: IMaster): number {
        return value.id
      },
    },
  })
  prefecture_id: IMaster
```

# å‚è€ƒæ–‡çŒ®

https://stackoverflow.com/questions/59760551/typeorm-column-value-from-sanitized-other-column-value

https://typeorm.io/#/entities/column-options

# æœ€å¾Œã«

èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚
ä»Šå›ã®è¨˜äº‹ã¯ã„ã‹ãŒã§ã—ãŸã‹ï¼Ÿ
ãƒ»ã“ã†ã„ã†è¨˜äº‹ãŒèª­ã¿ãŸã„
ãƒ»ã“ã†ã„ã†ã¨ã“ã‚ãŒè‰¯ã‹ã£ãŸ
ãƒ»ã“ã†ã—ãŸæ–¹ãŒè‰¯ã„ã®ã§ã¯ãªã„ã‹
ãªã©ãªã©ã€ç‡ç›´ãªã”æ„è¦‹ã‚’å‹Ÿé›†ã—ã¦ãŠã‚Šã¾ã™ã€‚