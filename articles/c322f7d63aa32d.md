---
title: "Cloud Functions ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã¾ã¨ã‚"
emoji: "ğŸŒŸ"
type: "tech"
topics:
  - "gcp"
  - "cloudfunctions"
  - "cloudsql"
published: true
published_at: "2022-01-31 01:36"
---

# æ¦‚è¦

`Cloud Functions`ã‚’GCPå­¦ç¿’ã®ä¸€ç’°ã§è§¦ã£ã¦ã¿ãŸã®ã§æ©Ÿèƒ½ã‚’ã¾ã¨ã‚ã¦ã¿ã‚‹

https://www.udemy.com/course/google-cloud-platform-gcp/

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2022-01-30 21.58.43.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555632/8a19d8a3-d0c9-c9ca-1f63-f81952631277.png)

# `Cloud Functions`ã¨ã¯
- ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ï¼ˆã‚µãƒ¼ãƒãƒ¼ã®ç®¡ç†ãŒã„ã‚‰ãªã„ï¼‰
- è² è·ã«å¿œã˜ãŸè‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
- åˆ©ç”¨ã—ãŸåˆ†ã ã‘æ–™é‡‘ãŒç™ºç”Ÿã™ã‚‹ï¼ˆå¾“é‡èª²é‡‘åˆ¶ï¼‰


> ã‚µãƒ¼ãƒãƒ¼ç®¡ç†ãªã—ã§ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ãªå¾“é‡èª²é‡‘åˆ¶ Functions as a Serviceï¼ˆFaaSï¼‰ã€‚

https://cloud.google.com/functions?hl=ja

## `Cloud Functions`ã®ä½œæˆ
- ãƒˆãƒªã‚¬ãƒ¼URLã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæ¸¡ã•ã‚ŒãŸå¥‘æ©Ÿã§`Cloud Functions`ãŒç™ºç«ã—ã¾ã™

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2022-01-30 22.46.36.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555632/29ad6d0a-2b81-f932-4890-c0501afb56ba.png)

- ä»Šå›ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ãã®ã¾ã¾ä½œæˆã—ã¾ã™
![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2022-01-30 22.21.04.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555632/39f55317-9ed6-ab68-b874-e4c6a83a4f51.png)

## ãƒˆãƒªã‚¬ãƒ¼URLã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2022-01-30 22.48.11.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555632/5d2dce76-7915-83ee-2503-40d585a370b5.png)

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2022-01-30 22.49.26.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555632/013bb491-0be0-a78f-2c7d-77826f413a48.png)

## ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ›´æ–°ã—ã¦ã¿ã‚‹

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2022-01-30 22.51.57.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555632/31b53f2f-2d83-f7b3-8793-da3f20185dbb.png)

```js:index.js
/**
 * Responds to any HTTP request.
 *
 * @param {!express:Request} req HTTP request context.
 * @param {!express:Response} res HTTP response context.
 */
exports.helloWorld = (req, res) => {
  let message = req.query.message || req.body.message || 'Hello GCP!';
  res.status(200).send(message);
};
```

```json:package.json
{
  "name": "sample-http",
  "version": "0.0.2"
}
```

- æ›´æ–°å¾Œãƒˆãƒªã‚¬ãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨å‡ºåŠ›ãŒæ›´æ–°ã•ã‚Œã¦ã„ã¾ã™
![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2022-01-30 22.54.18.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555632/3acb84e6-ba73-818e-b7f8-df9cf6209cc4.png)

## `Cloud SQL`ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹

### ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚’è¨±å¯ã™ã‚‹
- ãƒ—ãƒ­ã‚­ã‚·çµŒç”±ã§`Cloud SQL`ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2022-01-31 0.40.30.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555632/b50b16f1-d669-0131-e5c6-7db0790bb4d6.png)

### ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒè¿½åŠ ã•ã‚Œã‚‹
- è¡¨ç¤ºã•ã‚ŒãŸæ¥ç¶šåã§`Cloud Functions`ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹
![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2022-01-31 0.42.26.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555632/5e9fab9c-a0a9-a52d-1dd8-74f80d483aa9.png)

## `Cloud Functions`ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ›´æ–°ã™ã‚‹

```js:index.js
const mysql = require('mysql');

const connectionName = 'æ¥ç¶šå';
const dbUser =  'ãƒ¦ãƒ¼ã‚¶å';
const dbPassword =  'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰';
const dbName =  'DBå';

exports.demo = (req, res) => {
  const connection = mysql.createConnection({
    socketPath: "/cloudsql/" + connectionName,
    user: dbUser,
    password: dbPassword,
    database: dbName
  });

  connection.connect();

  connection.query('SELECT * FROM users', (err, results) => {
    if (err) {
      console.error(err);
      res.status(500).send(err);
    } else {
      res.send(JSON.stringify(results));
    }
  });
  connection.end();

};
```

```json:package.json
{
  "name": "sample-http",
  "version": "0.0.3",
  "dependencies": {
    "mysql": "latest"
  }
}
```

### `Cloud SQL`ã«ä¿å­˜ã—ãŸãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹
![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2022-01-31 0.59.11.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555632/845608ca-77dc-248f-ba56-e1c7b402fd6c.png)

## `Cloud SQL`ã«ãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²ã™ã‚‹

### `Cloud Functions`ã‚’æ–°ãŸã«ä½œæˆã™ã‚‹

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2022-01-31 1.04.39.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555632/27fa5aab-9c1f-07eb-e6e4-672f5dc24487.png)


```js:index.js
const mysql = require('mysql');

const connectionName = 'æ¥ç¶šå';
const dbUser =  'ãƒ¦ãƒ¼ã‚¶å';
const dbPassword =  'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰';
const dbName =  'DBå';

exports.create = (req, res) => {
  const connection = mysql.createConnection({
    socketPath: "/cloudsql/" + connectionName,
    user: dbUser,
    password: dbPassword,
    database: dbName
  });

  connection.connect();

  if (!req.query['name']) {
    res.send('none');
    return;
  }
  const  addName = "'"  + req.query['name'] +  "'";
  connection.query('INSERT INTO  users (name) VALUES(' + addName + ')', (err, results) => {
    if (err) {
      console.error(err);
      res.status(500).send(err);
    } else {
      res.send(JSON.stringify(results));
    }
  });
  connection.end();

};

```

```json:package.json
{
  "name": "sample-http",
  "version": "0.0.1",
  "dependencies": {
    "mysql": "latest"
  }
}
```

### ä½œæˆã—ãŸãƒˆãƒªã‚¬ãƒ¼ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æŠ•ã’ã‚‹

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2022-01-31 1.14.42.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555632/36930f75-bef4-410a-7a2c-288c42d5ac5f.png)

- `ãƒˆãƒªã‚¬ãƒ¼?name=demo` ã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã§`INSERT`å‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã‚‹
![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2022-01-31 1.16.06.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555632/d34e3806-f13a-bafd-9adc-40bc7dc088cb.png)

- å…ˆã»ã©ä½œæˆã—ãŸ`DB`ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ãƒˆãƒªã‚¬ãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ç™»éŒ²ã—ãŸãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã§ãã‚‹
![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2022-01-31 1.17.06.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555632/c866d9dd-5477-99c2-1903-15a6c5ca7882.png)

# ã¾ã¨ã‚

ä»Šå›ã¯`Cloud Functions`ã®æ§‹ç¯‰ã€œ`Cloud SQL`ã¨ã®é€£æºã¾ã§ã¾ã¨ã‚ã¾ã—ãŸ
ã„ã„ã­ã—ã¦ã„ãŸã ã‘ã‚‹ã¨è¨˜äº‹åŸ·ç­†ã®åŠ±ã¿ã«ãªã‚Šã¾ã™ã®ã§ã€å‚è€ƒã«ãªã£ãŸã¨æ€ã£ãŸæ–¹ã¯æ˜¯éã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ï¼
