---
title: "Laravel + GCS ã§storageç®¡ç†ã—ã¦ã„ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’CGSã§ç®¡ç†ã™ã‚‹ã‚ˆã†ã«ã—ãŸæ™‚ã®å‚™å¿˜éŒ²"
emoji: "ğŸ’¡"
type: "tech"
topics:
  - "laravel"
  - "å‚™å¿˜éŒ²"
  - "gcs"
published: true
published_at: "2022-01-02 21:50"
---

# ã¯ã˜ã‚ã«

ã“ã®è¨˜äº‹ã¯`Laravel`ã‹ã‚‰ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’`GCS`ã«ä¿å­˜ã™ã‚‹ã‚ˆã†ã«ã—ãŸæ–¹æ³•ã‚’ã¾ã¨ã‚ã‚‹

# ã‚„ã‚Šæ–¹

## äº‹å‰æº–å‚™:GCPã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ»ãƒã‚±ãƒƒãƒˆã®ä½œæˆ

ä»¥ä¸‹ã®è¨˜äº‹ã‚’å‚è€ƒã«ã—ã¾ã—ãŸğŸ™‡â€â™‚ï¸

https://blog.capilano-fw.com/?p=3359

## `.env`ã«ç™»éŒ²ã—ãŸãƒã‚±ãƒƒãƒˆåã‚’å…¥åŠ›ã™ã‚‹

```text:.env
GCS_BUCKET_NAME="hoge-bucket"
```

## `.env`ã®å€¤ã‚’`app.php`ã‹ã‚‰å‚ç…§ã™ã‚‹

```php:src/laravel/config/app.php
'gcp_bucket_name' => env('GCS_BUCKET_NAME', 'hoge-bucket'),
```

## GCSã‚’æ“ä½œã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
composer require google/cloud-storage
```

https://packagist.org/packages/google/cloud-storage

https://googleapis.github.io/google-cloud-php/#/

## google/cloud-storageã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã™ã‚‹

- äº‹å‰æº–å‚™ã§ä½œæˆã—ãŸãƒã‚±ãƒƒãƒˆã®èªè¨¼ã‚­ãƒ¼ã‚’`storage`ç›´ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã¾ã™


`Config('app.gcp_bucket_name');`:`app.php`ã‹ã‚‰ãƒã‚±ãƒƒãƒˆåã‚’å‚ç…§ã—ã¾ã™

`$url = file_get_contents()`:äº‹å‰æº–å‚™ã§ä½œæˆã—ãŸã‚­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã—ã¾ã™

`new StorageClient([ãƒã‚±ãƒƒãƒˆå,ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ã‚­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«])`:

`$client->bucket();`:ãƒã‚±ãƒƒãƒˆã‚’ç”Ÿæˆã—ã¾ã™

```php:src/laravel/app/Services/Utilities/UtilityService.php
<?php

namespace App\Services\Utilities;

use Google\Cloud\Storage\Bucket;
use Google\Cloud\Storage\StorageClient;
use Illuminate\Http\Request;
use Illuminate\Http\UploadedFile;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Gate;
use Illuminate\Support\Facades\Hash;
use stdClass;

class UtilityService
{

    public Bucket $bucket;
    public array $bucketOptions;

    public function __construct()
    {
        $projectId = Config('app.google_project_bucket_name');
        $url = file_get_contents(storage_path('app/local-service-account.json', true));
        $client = new StorageClient([
            'projectId' => $projectId,
            'keyFile' => json_decode($url, true)
        ]);
        $this->bucket = $client->bucket($projectId);
        $this->bucketOptions = [
            'resumable' => true, // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚’å†é–‹å¯èƒ½ã«è¡Œã†ã‹
            'name' => '',
            'metadata' => [
                // æ—¥æœ¬èªåŒ–
                'contentLanguage' => 'ja'
            ]
        ];
    }

    /**
     * adminæ¨©é™ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒã‚§ãƒƒã‚¯
     *
     * @return bool
     */
    public function isAccessByAdmin(): bool
    {
        return Gate::allows('admin');
    }

    /**
     * ä»®ç™»éŒ²GCSä¿å­˜åã‚’ä½œæˆ
     *
     * @param UploadedFile $file
     * @param string $dirName
     * @param string $uniqueKey
     * @param array $options
     * @return array
     */
    public function setBucketOptions(UploadedFile $file, string $dirName, string $uniqueKey, array $options): array
    {
        $extension = $file->extension();
        $fileName = "{$uniqueKey}_{$dirName}.{$extension}";

        // ä¿å­˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç”Ÿæˆ
        $options['name'] = "tmp/skill_sheet/{$uniqueKey}/{$dirName}/{$fileName}";
        return $options;
    }

    /**
     * ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒæƒ…å ±ã‚’ã‚¯ãƒ©ã‚¹ã«è©°ã‚ã‚‹
     * @param $thumbnailFile
     * @param $targetId
     * @param $model
     * @param $thumbnailFileName
     * @param $thumbnailFileObject
     * @return stdClass
     */
    public function setThumbnailClass($thumbnailFile, $targetId, $model, $thumbnailFileName, $thumbnailFileObject): stdClass
    {
        $thumbnailClass = new stdClass();
        $thumbnailClass->original_name = is_null($thumbnailFile) && !is_null($targetId) ? $model->thumbnail_file_name : $thumbnailFile->getClientOriginalName();
        $thumbnailClass->name = is_null($thumbnailFile) && !is_null($targetId) ? $model->thumbnail_path : $thumbnailFileName;
        $thumbnailClass->single_url = is_null($thumbnailFile) && !is_null($targetId) ? $model->thumbnail_path : $thumbnailFileObject->signedUrl(time() + 3600);
        return $thumbnailClass;
    }
}
```

## ä½¿ã„æ–¹

### `Controller`ã‹ã‚‰å¿…è¦ãªè¦ç´ ã‚’`Service`ã«æ¸¡ã™

```php:src/laravel/app/Http/Controllers/Admin/SkillSheetController.php
class SkillSheetController extends Controller
{
    protected SkillSheetService $service;
    protected UtilityService $utilityService;

    public function __construct()
    {
        $this->service = new SkillSheetService();
        $this->utilityService = new UtilityService();
    }

 /**
     * ç¢ºèª
     *
     * @param StoreSkillSheetRequest $request
     * @return View|Factory
     */
    public function confirm(StoreSkillSheetRequest $request)
    {
        $data = collect($request->input());

        // ãƒ•ã‚¡ã‚¤ãƒ«é€ä¿¡ãŒã‚ã‚Œã°
        if (!empty($request->file())) {
            //ãƒ‘ã‚¹ã«æŒ‡å®šã™ã‚‹ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªéµtmp/skill_sheet/{ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªå€¤}
            $uniqueKey = uniqid('', true);

            // ä»®ç™»éŒ²ãƒ‘ã‚¹åã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§å—ã‘æ¸¡ã™
            $saveNames = $this->service->tmpStorageToGcsBucket($request, $uniqueKey);

            $collect = collect($saveNames);

            // ãƒã‚±ãƒƒãƒˆåˆæœŸåŒ–ã—ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‹ã‚‰GCSã«ä¿å­˜ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«åã‚’å–å¾—
            $bucket = $this->utilityService->bucket;
            $prImageName = $collect->get('pr_image');
            $prVideoName = $collect->get('pr_video');
            $otherDocumentName = $collect->get('other_document');

            // ç½²åä»˜ãã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰URLã‚’ä½œæˆ
            $prImageSignedPath = $prImageName && $bucket->object($prImageName)->exists() ? $bucket->object($prImageName)->signedUrl(new \DateTime('tomorrow')) : null;
            $prVideoSignedPath = $prVideoName ? $bucket->object($prVideoName)->signedUrl(new \DateTime('tomorrow')) : null;
            $otherDocumentSignedPath = $otherDocumentName ? $bucket->object($otherDocumentName)->signedUrl(new \DateTime('tomorrow')) : null;

            // ç¢ºèªç”»é¢ã§ä½¿ç”¨ã™ã‚‹ä»®ä¿å­˜åã¨èªå¯ãƒ‘ã‚¹ã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ä¿æŒ
            $imagePath->pr_image_name = $prImageName;
            $imagePath->pr_video_name = $prVideoName;
            $imagePath->other_document_name = $otherDocumentName;
            $imagePath->pr_image_path = $prImageSignedPath;
            $imagePath->pr_video_path = $prVideoSignedPath;
            $imagePath->other_document_path = $otherDocumentSignedPath;
        }

        return view('admin.skill_sheet.conf', [
            'skillSheet' => $data,
            'imagePath' => $imagePath,
            'jobTypes' => $jobTypes,
            'partnerGroups' => $partnerGroups,
            'partner' => $partner
        ]);
    }
}
```

## é€ä¿¡æ™‚ã«GCSã«ä¸€æ™‚ä¿å­˜ã™ã‚‹

`tmp/images/ä¸€æ„ãªå€¤`ã«ä¿å­˜ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™

`images/ä¸€æ„ãªå€¤ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ID`ã«ä¿å­˜ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™
ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ä¸€æ™‚ä¿å­˜ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«åã‚’ä¿æŒã—ã¦ã„ã‚‹çŠ¶æ…‹ã¨ä»®å®šã—ã¾ã™

```php:src/laravel/app/Services/SkillSheet/SkillSheetService.php
protected UtilityService $utilityService;

class SkillSheetService
{
    protected UtilityService $utilityService;

    public function __construct()
    {
        $this->utilityService = new UtilityService();
    }

    /**
     * è©³ç´°
     *
     * @param integer $id
     * @return SkillSheet
     */
    public function detail(int $id): SkillSheet
    {
        $skillSheet = SkillSheet::findOrFail($id);

        // ãƒã‚±ãƒƒãƒˆåˆæœŸåŒ–
        $bucket = $this->utilityService->bucket;
        $prImagePath = $skillSheet->pr_image_path;
        $prVideoPath = $skillSheet->pr_video_path;
        $otherDocumentPath = $skillSheet->other_document_path;

        // ç½²åä»˜ãã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰URLã‚’ä½œæˆ
        $prImageSignedPath = $prImagePath && $bucket->object($prImagePath)->exists() ? $bucket->object($prImagePath)->signedUrl(new \DateTime('tomorrow')) : null;
        $prVideoSignedPath = $prVideoPath ? $bucket->object($prVideoPath)->signedUrl(new \DateTime('tomorrow')) : null;
        $otherDocumentSignedPath = $otherDocumentPath ? $bucket->object($otherDocumentPath)->signedUrl(new \DateTime('tomorrow')) : null;

        // ä¸Šæ›¸ã
        $skillSheet->pr_image_path = $prImageSignedPath;
        $skillSheet->pr_video_path = $prVideoSignedPath;
        $skillSheet->other_document_path = $otherDocumentSignedPath;
        return $skillSheet;
    }
}

   /**
     * ç™»éŒ²
     *
     * @param Collection $storeData
     * @return void
     */
    public function store(Collection $storeData): void
    {
        DB::transaction(function () use (
            $storeData,
        ) {

            $loginUser = Auth::user()->name;

            $storeSkillSheet = array_merge(
                (new SkillSheet())->fill($storeData->toArray())->toArray(),
                ['create_user' => $loginUser],
                ['update_user' => $loginUser],
            );

            $skillSheetId = DB::table('skill_sheets')->insertGetId($storeSkillSheet);

            $target = SkillSheet::findOrFail($skillSheetId);

            $updSkillSheet = [];

            // ç”»åƒãŒé€ä¿¡ã•ã‚ŒãŸå ´åˆã¯ä»®ç™»éŒ²ã‚’æœ¬ç•ªã«å·®ã—æ›¿ãˆ
            if (Session::has('saveNames')) {
                $updSkillSheet = $this->storageToGcsBucket($skillSheetId, $target, $updSkillSheet);
            }

            $target->fill($updSkillSheet)->save();
        });
    }

/**
     * GCSã¸ã®ä»®ä¿å­˜
     *
     * @param StoreSkillSheetRequest $request
     * @param string $uniqueKey
     * @return array
     */
    public function tmpStorageToGcsBucket(StoreSkillSheetRequest $request, string $uniqueKey): array
    {
        // ãƒã‚±ãƒƒãƒˆã‚¤ãƒ‹ã‚·ãƒ£ãƒ©ã‚¤ã‚º
        $bucket = $this->utilityService->bucket;

        // ç™»éŒ²ã—ãŸä¿å­˜åã‚’ä¿æŒã—ã¦ã„ã
        $saveNames = [];

        // PRå†™çœŸãƒ»å‹•ç”»ãƒ»å‚è€ƒè³‡æ–™ã‚’ãã‚‹ãã‚‹å›ã™
        foreach ($request->file() as $key => $files) {
            // nameå±æ€§ã«å¿œã˜ã¦ä¿å­˜å…ˆã‚’åˆ‡ã‚Šåˆ†ã‘ã‚‹
            foreach ($files as $file) {
                $options = $this->utilityService->setBucketOptions(
                    $file,
                    $key,
                    $uniqueKey,
                    $this->utilityService->bucketOptions
                );

                $saveNames[$key] = $options['name'];

                $bucket->upload(
                    fopen($file, 'rb'),
                    $options
                );
            }
        }

        return $saveNames;
    }

    /**
     * GCSä¿å­˜
     *
     * @param integer $id
     * @param SkillSheet $target
     * @param array $updSkillSheet
     * @return array
     */
    public function storageToGcsBucket(int $id, SkillSheet $target, array $updSkillSheet): array
    {
        // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ç ´æ£„ã™ã‚‹
        $saveNames = Session('saveNames');
        session()->forget('saveNames');

        // ãƒã‚±ãƒƒãƒˆã‚¤ãƒ‹ã‚·ãƒ£ãƒ©ã‚¤ã‚º
        $bucket = $this->utilityService->bucket;

        // ä»®ç™»éŒ²ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ç§»å‹•ã•ã›ã¦ã‹ã‚‰å‰Šé™¤ã™ã‚‹
        foreach ($saveNames as $key => $v) {
            switch ($key) {
                case Element::PR_IMAGE:
                    // ä»®ç™»éŒ²ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒãƒã‚±ãƒƒãƒˆã«å­˜åœ¨ã™ã‚‹å ´åˆã¯ç§»ç®¡ã™ã‚‹
                    $targetObject = $bucket->object($v);
                    $extension = pathinfo($v)['extension'];
                    $name = "skill_sheet/{$id}/{$key}/{$id}_{$key}.{$extension}";

                    // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯ä»®ç½®ãã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ã¦ç§»å‹•ã™ã‚‹ãƒ»ä»®ç½®ãã¯å‰Šé™¤ã™ã‚‹
                    if ($targetObject->exists()) {
                        $targetObject->copy($bucket, ['name' => $name]);
                        $targetObject->delete();
                    }

                    // ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ãŒæ—¢ã«ã‚ã‚‹å ´åˆã¯å·®ã—æ›¿ãˆã‚‹(æ›´æ–°)
                    if ($target->pr_image_path) {
                        // å·®ã—æ›¿ãˆå‰ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å–å¾—
                        $beforeObject = $bucket->object($target->pr_image_path);

                        // å·®ã—æ›¿ãˆå‰ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã‚Œã°å‰Šé™¤
                        if ($beforeObject->exists()) {
                            $beforeObject->delete();
                        } else {
                            // å·®ã—æ›¿ãˆå‰ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒãªã„ã®ã«DBã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ãƒªã‚»ãƒƒãƒˆã™ã‚‹
                            $updSkillSheet['pr_image_path'] = null;
                        }
                    }
                    $updSkillSheet = array_merge(
                        $updSkillSheet,
                        ["pr_image_path" => $name]
                    );
                    break;
                case Element::PR_VIDEO:
                    // ä»®ç™»éŒ²ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒãƒã‚±ãƒƒãƒˆã«å­˜åœ¨ã™ã‚‹å ´åˆã¯ç§»ç®¡ã™ã‚‹
                    $targetObject = $bucket->object($v);
                    $extension = pathinfo($v)['extension'];
                    $name = "skill_sheet/{$id}/{$key}/{$id}_{$key}.{$extension}";

                    // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯ä»®ç½®ãã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ã¦ç§»å‹•ã™ã‚‹ãƒ»ä»®ç½®ãã¯å‰Šé™¤ã™ã‚‹
                    if ($targetObject->exists()) {
                        $targetObject->copy($bucket, ['name' => $name]);
                        $targetObject->delete();
                    }

                    // ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ãŒæ—¢ã«ã‚ã‚‹å ´åˆã¯å·®ã—æ›¿ãˆã‚‹(æ›´æ–°)
                    if ($target->pr_video_path) {
                        // å·®ã—æ›¿ãˆå‰ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å–å¾—
                        $beforeObject = $bucket->object($target->pr_video_path);

                        // å·®ã—æ›¿ãˆå‰ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã‚Œã°å‰Šé™¤
                        if ($beforeObject->exists()) {
                            $beforeObject->delete();
                        } else {
                            // å·®ã—æ›¿ãˆå‰ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒãªã„ã®ã«DBã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ãƒªã‚»ãƒƒãƒˆã™ã‚‹
                            $updSkillSheet['pr_video_path'] = null;
                        }

                        // å•é¡Œãªã‘ã‚Œã°ç™»éŒ²ã™ã‚‹
                    }
                    $updSkillSheet = array_merge(
                        $updSkillSheet,
                        ["pr_video_path" => $name]
                    );
                    break;
                default:
                    // ä»®ç™»éŒ²ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒãƒã‚±ãƒƒãƒˆã«å­˜åœ¨ã™ã‚‹å ´åˆã¯ç§»ç®¡ã™ã‚‹
                    $targetObject = $bucket->object($v);
                    $extension = pathinfo($v)['extension'];
                    $name = "skill_sheet/$id/$key/{$id}_$key.$extension";

                    // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯ä»®ç½®ãã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ã¦ç§»å‹•ã™ã‚‹ãƒ»ä»®ç½®ãã¯å‰Šé™¤ã™ã‚‹
                    if ($targetObject->exists()) {
                        $targetObject->copy($bucket, ['name' => $name]);
                        $targetObject->delete();
                    }

                    // ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ãŒæ—¢ã«ã‚ã‚‹å ´åˆã¯å·®ã—æ›¿ãˆã‚‹(æ›´æ–°)
                    if ($target->other_document_path) {
                        // å·®ã—æ›¿ãˆå‰ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å–å¾—
                        $beforeObject = $bucket->object($target->other_document_path);

                        // å·®ã—æ›¿ãˆå‰ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã‚Œã°å‰Šé™¤
                        if ($beforeObject->exists()) {
                            $beforeObject->delete();
                        } else {
                            // å·®ã—æ›¿ãˆå‰ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒãªã„ã®ã«DBã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ãƒªã‚»ãƒƒãƒˆã™ã‚‹
                            $updSkillSheet['other_document_path'] = null;
                        }

                        // å•é¡Œãªã‘ã‚Œã°ç™»éŒ²ã™ã‚‹
                    }
                    $updSkillSheet = array_merge(
                        $updSkillSheet,
                        ["other_document_path" => $name]
                    );
                    break;
            }
        }
        return $updSkillSheet;
    }

    /**
     * GCSã®ç”»åƒã‚’ãƒ¢ãƒ¼ãƒ€ãƒ«ã«è¡¨ç¤ºã™ã‚‹ãŸã‚ã®å‡¦ç†
     *
     * @param integer $id
     * @return array|void
     */
    public function setPdfDownloadElement(int $id)
    {
        $skillSheet = SkillSheet::findOrFail($id);

        if ($skillSheet->other_document_path) {
            $bucket = $this->utilityService->bucket;
            $targetObject = $bucket->object($skillSheet->other_document_path);
            $isExists = $targetObject->exists();
            $signedPath = $isExists ? $targetObject->signedUrl(new \DateTime('tomorrow')) : null;
            $name = $isExists ? $targetObject->name() : null;
            $extension = mb_strtolower(pathinfo($name)['extension']);

            switch ($extension) {
                case 'pdf':
                    header('Content-Type:application/pdf');

                    break;
                case 'jpeg':
                case 'jpg':
                case 'png':
                    header('Content-Type:image/png,image/jpeg,image/jpg');
                    break;
            }

            if ($signedPath) {
                return [
                    'signedPath' => $signedPath,
                    'name' => $name
                ];
            }

            abort(404);
        }
    }
```





## ç§»å‹•å…ˆã«ãƒ•ã‚¡ã‚¤ãƒ«ã®å®Ÿä½“ãŒç§»å‹•ã•ã‚Œã¾ã™

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2022-01-02 21.31.33.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555632/bd655655-e750-72c4-5327-0fe7d03535b8.png)
