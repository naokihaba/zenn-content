---
title: "ã€GASã€‘ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’GASã§ã‚³ãƒ”ãƒ¼ã—ã¦ChatWorkã§é€šçŸ¥ã™ã‚‹ã‚¢ãƒ¬ã‚³ãƒ¬"
emoji: "ðŸ¦”"
type: "tech"
topics:
  - "javascript"
  - "gas"
published: true
published_at: "2022-06-16 00:10"
---

# æ¦‚è¦

ã€Œæ¯Žé€±ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦é€šçŸ¥ã™ã‚‹ä½œæ¥­ã‚’è‡ªå‹•åŒ–ã—ãŸã„ã€ã¨ã„ã†è¦æœ›ãŒã‚ã£ãŸã®ã§ã€ãƒ‘ãƒƒã¨ä½œã£ã¦ã¿ãŸ


# ã”åˆ©ç”¨ã•ã‚Œã‚‹ç’°å¢ƒã«ã‚ã‚ã›ã¦å¤‰æ›´ãã ã•ã„

```javascript
const mainWorker = () => {
  const mtgDate = getMtgDate()
  const previousMtgDate = getMtgDate(true)

  const SHEET_NAME = " ãƒ•ã‚¡ã‚¤ãƒ«å"
  const previousMtgName = previousMtgDate + SHEET_NAME
  const mtgName = mtgDate + SHEET_NAME
  const TEMPLATE_NAME = "2022å¹´åº¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ"

  const DIRECTORY_ID = "è¤‡è£½ã—ãŸã„ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªID"
  const TEMPLATE_DIRECTORY_ID = "ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªID"
  const directory = DriveApp.getFolderById(DIRECTORY_ID)
  const templateDirectory = DriveApp.getFolderById(TEMPLATE_DIRECTORY_ID)

  const previousFile = directory.getFilesByName(previousMtgName)
  const templateFile = templateDirectory.getFilesByName(TEMPLATE_NAME)
  const result = previousFile.hasNext() ? copyFile(previousFile, directory, mtgName) : copyFile(templateFile, directory, mtgName)

  if (result) {
    const url = directory.getFilesByName(mtgName).next().getUrl()
    const message = "[toall]\nä½œæˆã—ã¾ã—ãŸã‚ˆï¼\n" + url;
    sendChatWork(message);
  }
}

/**
 * https://github.com/cw-shibuya/chatwork-client-gas
 */
const sendChatWork = (message) => {
  const client = ChatWorkClient.factory({ token: "API Token" });
  client.sendMessage({ room_id: é€šçŸ¥ã—ãŸã„ãƒ«ãƒ¼ãƒ ID, body: message });
}


const copyFile = (copyFile, directory, mtgName) => {
  if (!copyFile.hasNext()) {
    sendChatWork("ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚")
    return;
  }

  const file = copyFile.next();

  // é‡è¤‡ã—ãªã„å ´åˆã ã‘ä½œæˆ
  if (!directory.getFilesByName(mtgName).hasNext()) {
    file.makeCopy(mtgName, directory)
    return true;
  }
  else {
    sendChatWork("é‡è¤‡ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ã¾ã™")
    return;
  }
}

const getMtgDate = (isPrevious) => {
  let date = new Date()
  isPrevious ? date.setDate(date.getDate() - 7) : date.setDate(date.getDate() + 1)
  return Utilities.formatDate(date, 'JST', 'YYYY/MM/dd');
}
```
