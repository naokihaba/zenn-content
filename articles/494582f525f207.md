---
title: "ã€ApolloClientã€‘ReferenceError: fetch is not defined ã§TestãŒè½ã¡ã‚‹å ´åˆã®å¯¾å‡¦æ–¹æ³•"
emoji: "ğŸ¤–"
type: "tech"
topics:
  - "graphql"
  - "test"
  - "apollo"
  - "reac"
published: true
published_at: "2022-07-18 00:21"
---

# æ¦‚è¦

`Navigation`ã®ãƒ†ã‚¹ãƒˆã‚’`React-testing-library`ã§å®Ÿè¡Œã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ã§ãƒ†ã‚¹ãƒˆãŒè½ã¡ãŸã€‚

ä»¥ä¸‹ã‚’å‚è€ƒã«ã—ã¦ã‚¨ãƒ©ãƒ¼ã‚’æ­£å¸¸åŒ–ã•ã›ãŸã®ã§æ–¹æ³•ã‚’æ®‹ã™

https://stackoverflow.com/questions/50688998/using-apolloclient-with-node-js-fetch-is-not-found-globally-and-no-fetcher-pas

```bash
ReferenceError: fetch is not defined
```

```ts
const createApolloClient = () => {
  return new ApolloClient({
    // ãƒ–ãƒ©ã‚¦ã‚¶ã§å®Ÿè¡Œã—ã¦ã‚‹å ´åˆã¯windowã«å€¤ãŒã‚ã‚‹ SSRã‹CSRã‹ã‚’åˆ‡ã‚Šæ›¿ãˆ
    ssrMode: typeof window === 'undefined',

    // hasuraã®APIãƒªãƒ³ã‚¯
    link: new HttpLink({
      uri: 'https://hoge.hasura.app/v1/graphql'
    }),

    // ãŠæ±ºã¾ã‚Šã®å‘ªæ–‡
    cache: new InMemoryCache()
  })
}
```

# å¯¾å‡¦æ–¹æ³•

`import 'cross-fetch/polyfill` ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ãƒ†ã‚¹ãƒˆãŒæ­£å¸¸ã«é€šã‚‹ã‚ˆã†ã«ãªã‚‹

```typescript
import 'cross-fetch/polyfill'

const createApolloClient = () => {
  return new ApolloClient({
    // ãƒ–ãƒ©ã‚¦ã‚¶ã§å®Ÿè¡Œã—ã¦ã‚‹å ´åˆã¯windowã«å€¤ãŒã‚ã‚‹ SSRã‹CSRã‹ã‚’åˆ‡ã‚Šæ›¿ãˆ
    ssrMode: typeof window === 'undefined',

    // hasuraã®APIãƒªãƒ³ã‚¯
    link: new HttpLink({
      uri: 'https://hoge.hasura.app/v1/graphql'
    }),

    // ãŠæ±ºã¾ã‚Šã®å‘ªæ–‡
    cache: new InMemoryCache()
  })
}
```