---
title: "TypeORMã§Entityã‚’å®šç¾©ã™ã‚‹åŸºæœ¬çŸ¥è­˜"
emoji: "ğŸˆ"
type: "tech"
topics:
  - "typescript"
  - "typeorm"
  - "entity"
published: true
published_at: "2021-11-28 16:53"
---

# æ¦‚è¦

TypeORMã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—ãŸéš›ã®å‚™å¿˜éŒ²ã§ã™

ã“ã‚Œã‹ã‚‰å°å…¥ã•ã‚Œã‚‹æ–¹ã‚„åˆã‚ã¦ä½¿ã†æ–¹ã®å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™

# ç”¨èªã®èª¬æ˜

## TypeORMã¨ã¯
> TypeORMã¯ã€NodeJSã€Browserã€Cordovaã€PhoneGapã€Ionicã€React Nativeã€NativeScriptã€Expoã€Electronã®å„ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§å‹•ä½œã—ã€TypeScriptã¨JavaScript(ES5, ES6, ES7, ES8)ã§ä½¿ç”¨ã§ãã‚‹ORMã§ã™

# Entityã®å®šç¾©(è§£èª¬ï¼‰


## ä»Šå›ä½¿ç”¨ã™ã‚‹moduleã¨serviceã‚’importã™ã‚‹

```ts:Contractor.ts
import {
    Column,
    PrimaryGeneratedColumn,
    CreateDateColumn,
    Timestamp,
    UpdateDateColumn,
    DeleteDateColumn,
    Entity,
    OneToMany,
    OneToOne,
    JoinColumn,
  } from 'typeorm'
```

| ã‚µãƒ¼ãƒ“ã‚¹ | èª¬æ˜ |
|-----------|------------|
| Column|ãƒ†ãƒ¼ãƒ–ãƒ«ã‚«ãƒ©ãƒ |
| PrimaryGeneratedColumn|è‡ªå‹•å¢—æ¸›ã®ä¸»ã‚­ãƒ¼ã‚«ãƒ©ãƒ |
| CreateDateColumn|ãƒ‡ãƒ¼ã‚¿æŒ¿å…¥æ™‚ã«è‡ªå‹•ã§è¨­å®šã•ã‚Œã‚‹ã‚«ãƒ©ãƒ |
| Timestamp |ã‚«ãƒ©ãƒ ã®ãƒ‡ãƒ¼ã‚¿å‹ã§ä½¿ç”¨|
| UpdateDateColumn |ãƒ‡ãƒ¼ã‚¿æ›´æ–°æ™‚ã«è‡ªå‹•ã§è¨­å®šã•ã‚Œã‚‹ã‚«ãƒ©ãƒ |
| Entity |ã‚¯ãƒ©ã‚¹ãŒEntityã§ã‚ã‚‹ã“ã¨ã‚’å®šç¾©|
| OneToMany |1å¯¾å¤š/å¤šå¯¾1ã®é–¢ä¿‚ã‚’å®šç¾©ã™ã‚‹ã‚«ãƒ©ãƒ |
| OneToOne |1å¯¾1ã®é–¢ä¿‚ã‚’å®šç¾©ã™ã‚‹ã‚«ãƒ©ãƒ |
| JoinColumn |å¤–éƒ¨ã‚­ãƒ¼ã‚’æŒã¤ã‚«ãƒ©ãƒ ã‚’å®šç¾©ã™ã‚‹|

https://github.com/typeorm/typeorm/blob/master/docs/decorator-reference.md#primarycolumn

1å¯¾å¤šãƒ»ï¼‘å¯¾1ãŒãƒ”ãƒ³ãƒˆã“ãªã„æ–¹ã¯ã“ã¡ã‚‰ã«ç›®ã‚’é€šã—ã¦ã¿ã¦ãã ã•ã„

https://orkhan.gitbook.io/typeorm/docs/many-to-one-one-to-many-relations

https://orkhan.gitbook.io/typeorm/docs/one-to-one-relations

## ä½œæˆã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«åã‚’å®šç¾©ã™ã‚‹

:::message
`@Entity('ä½œæˆã—ãŸã„ãƒ†ãƒ¼ãƒ–ãƒ«å')`
:::
```ts:Contractor.ts
@Entity('contractors')
```

## ä¸»ã‚­ãƒ¼ã‚’å®šç¾©ã—ã¾ã™

:::message
`unsigned`ï¼šUNSIGNEDå±æ€§ã‚’æ•°å€¤åˆ—ã«ä»˜ä¸ã—ã¾ã™ï¼ˆMySQLé™å®šï¼‰
`comment`:ã‚«ãƒ©ãƒ ã®èª¬æ˜
`readonly`:èª­ã¿å–ã‚Šå°‚ç”¨ã®ã‚«ãƒ©ãƒ ã«ä»˜ä¸ã—ã¾ã™
:::

```ts:Contractor.ts
    @PrimaryGeneratedColumn({
      name: 'id',
      unsigned: true,
      type: 'smallint',
      comment: 'å¥‘ç´„ID',
    })
    readonly id: number
```

## NUllã‚’è¨±å®¹ã™ã‚‹ã‚«ãƒ©ãƒ (Nullableï¼‰ã‚’å®šç¾©ã—ã¾ã™

:::message
`nullable`:NULLã‚’è¨±å®¹ã—ã¾ã™
`ins_admin_user_id:xxx| null = null` ï¼šå®Ÿè¡Œæ™‚ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒNULLã®å ´åˆã«ä¸ä¸€è‡´ã«ãªã‚‹ã®ã‚’é˜²ã
:::

```ts:Contractor.ts
    @Column('varchar', { comment: 'ç™»éŒ²è€…', nullable: true })
    ins_admin_user_id: string | null = null
```

## ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®šç¾©ã—ã¾ã™

:::message
1å¯¾1ã®é–¢ä¿‚ã‚’å®šç¾©ã—ã¾ã™
`createForeignKeyConstraints`:å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã®ä½œæˆã‚’å›é¿ã—ã¾ã™
`persistence`:ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ä¿å­˜ä¸­ã«è¤‡æ•°ã®ä½™åˆ†ãªã‚¯ã‚¨ãƒªãŒå›é¿ã•ã‚Œã‚‹ãŸã‚ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®æœ€é©åŒ–ã«å½¹ç«‹ã¡ã¾ã™ã€‚
:::
```ts:Contractor.ts
    @OneToOne(() => Plan, (plan) => plan.contractor, {
      createForeignKeyConstraints: false,
      persistence: false,
    })
    @JoinColumn({
      name: 'plan_id',
      referencedColumnName: 'id',
    })
    readonly plan?: Plan

/*
  // å¥‘ç´„ãƒ—ãƒ©ãƒ³ã®Entityå®šç¾©
   @OneToOne(() => Contractor, (contractor) => contractor.plan, {
    createForeignKeyConstraints: false,
    persistence: false,
  })
  readonly contractor?: Contractor
*/
```

https://github.com/typeorm/typeorm/blob/51b2a63d/src/decorator/options/RelationOptions.ts#L59


:::message
1å¯¾å¤š/å¤šå¯¾1ã®é–¢ä¿‚ã‚’å®šç¾©ã—ã¾ã™
`createForeignKeyConstraints`:å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã®ä½œæˆã‚’å›é¿ã—ã¾ã™
`persistence`:ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ä¿å­˜ä¸­ã«è¤‡æ•°ã®ä½™åˆ†ãªã‚¯ã‚¨ãƒªãŒå›é¿ã•ã‚Œã‚‹ãŸã‚ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®æœ€é©åŒ–ã«å½¹ç«‹ã¡ã¾ã™ã€‚
:::
```ts:Contractor.ts
    @OneToMany(() => Terminal, (terminal) => terminal.contractor, {
      createForeignKeyConstraints: false,
      persistence: false,
    })
    readonly terminals?: Terminal[]

/*
  // ç«¯æœ«ã®Entityå®šç¾©
  @ManyToOne(() => Contractor, (contractor) => contractor.terminals, {
    createForeignKeyConstraints: false,
    persistence: false,
  })
  @JoinColumn({
    name: 'contractor_id',
    referencedColumnName: 'id',
  })
  readonly contractor?: Contractor
*/
```

## constractorã‚’å®šç¾©ã—ã¾ã™

:::message
åˆæœŸå€¤ã®ã‚ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’é™¤ã„ã¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¸å¤‰æ¡ä»¶ã‚’æº€ãŸã™ãŸã‚ã«`constructor`ã‚’è¨­å®šã—ã¾ã™
:::
```ts:Contractor.ts
  constructor(
    name: string,
    terminal_activate_possible_count: number,
    license_period_days: number,
    archive_period_days: number,
    ins_admin_user_id: string | null,
    upd_admin_user_id: string | null,
    delete_admin_user_id: string | null,
    delete_flg: boolean
  ) {
    this.name = name
    this.terminal_activate_possible_count = terminal_activate_possible_count
    this.license_period_days = license_period_days
    this.archive_period_days = archive_period_days
    this.ins_admin_user_id = ins_admin_user_id
    this.upd_admin_user_id = upd_admin_user_id
    this.delete_flg = delete_flg
    this.delete_admin_user_id = delete_admin_user_id
  }
```


# ã‚³ãƒ¼ãƒ‰å…¨æ–‡

```ts:Contractor.ts
import {
    Column,
    PrimaryGeneratedColumn,
    CreateDateColumn,
    Timestamp,
    UpdateDateColumn,
    DeleteDateColumn,
    Entity,
    OneToMany,
    OneToOne,
    JoinColumn,
  } from 'typeorm'

  @Entity('contractors')
  export class Contractor {
    @PrimaryGeneratedColumn({
      name: 'id',
      unsigned: true,
      type: 'smallint',
      comment: 'å¥‘ç´„ID',
    })
    readonly id: number
  
    @Column('varchar', { comment: 'ä¼šç¤¾å' })
    organization_name: string
  
    @CreateDateColumn({ comment: 'ç™»éŒ²æ—¥æ™‚' })
    readonly ins_ts?: Timestamp
  
    @Column('varchar', { comment: 'ç™»éŒ²è€…', nullable: true })
    ins_admin_user_id: string | null = null
  
    @UpdateDateColumn({ comment: 'æœ€çµ‚æ›´æ–°æ—¥æ™‚' })
    readonly upd_ts?: Timestamp
  
    @Column('varchar', { comment: 'æ›´æ–°è€…', nullable: true })
    upd_admin_user_id: string | null = null
  
    @DeleteDateColumn({ comment: 'å‰Šé™¤æ—¥æ™‚' })
    readonly delete_ts?: Timestamp
  
    @Column('varchar', { comment: 'å‰Šé™¤è€…', nullable: true })
    delete_admin_user_id: string | null = null
    
    @OneToOne(() => Plan, (plan) => plan.contractor, {
      createForeignKeyConstraints: false,
      persistence: false,
    })
    @JoinColumn({
      name: 'plan_id',
      referencedColumnName: 'id',
    })
    readonly plan?: Plan

    @OneToMany(() => Terminal, (terminal) => terminal.contractor, {
      createForeignKeyConstraints: false,
      persistence: false,
    })
    readonly terminals?: Terminal[]
  
    constructor(
      organization_name: string,
      ins_admin_user_id: string | null,
      upd_admin_user_id: string | null,
      delete_admin_user_id: string | null,
      plan_id: number,
    ) {
      this.organization_name = organization_name
      this.ins_admin_user_id = ins_admin_user_id
      this.upd_admin_user_id = upd_admin_user_id
      this.delete_admin_user_id = delete_admin_user_id
      this.plan_id = plan_id
    }
  }
```

# å‚è€ƒæ–‡çŒ®

https://typeorm.io/#/

https://github.com/typeorm/typeorm/blob/master/docs/decorator-reference.md

https://tech.bitbank.cc/typeorm-entity-guideline/

# æœ€å¾Œã«

èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚
ä»Šå›ã®è¨˜äº‹ã¯ã„ã‹ãŒã§ã—ãŸã‹ï¼Ÿ
ãƒ»ã“ã†ã„ã†è¨˜äº‹ãŒèª­ã¿ãŸã„
ãƒ»ã“ã†ã„ã†ã¨ã“ã‚ãŒè‰¯ã‹ã£ãŸ
ãƒ»ã“ã†ã—ãŸæ–¹ãŒè‰¯ã„ã®ã§ã¯ãªã„ã‹
ãªã©ãªã©ã€ç‡ç›´ãªã”æ„è¦‹ã‚’å‹Ÿé›†ã—ã¦ãŠã‚Šã¾ã™ã€‚